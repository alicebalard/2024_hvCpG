match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
## Plot
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d()+
geom_violin()+
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 100000)
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
## Plot
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d()+
geom_violin()+
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 100000)
parent_dir <- here("05_hvCpGalgorithm/resultsDir/Atlas/Atlas10X_tissueAnalysis/")
rds_files <- list.files(parent_dir, pattern = "\\.rds$", recursive = TRUE, full.names = TRUE)
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
## Plot
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d()+
geom_violin()+
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
plot_violin_tissues
read.csv("../../04_prepAtlas/all_medsd_lambda.tsv")
read.table("../../04_prepAtlas/all_medsd_lambda.tsv")
read.table("../../04_prepAtlas/all_medsd_lambda.tsv", sep = "\t")
all_medsd_lambda <- read.table("../../04_prepAtlas/all_medsd_lambda.tsv", sep = "\t")
all_medsd_lambda <- read.table(here("04_prepAtlas/all_medsd_lambda.tsv"), sep = "\t")
all_medsd_lambda
## Lambdas
all_medsd_lambda <- read.table(here("04_prepAtlas/all_medsd_lambda.tsv"), sep = "\t", header = T)
View(all_medsd_lambda)
# Value used to transform the data
coeff <- 10
# A few constants
temperatureColor <- "#69b3a2"
priceColor <- rgb(0.2, 0.6, 0.9, 1)
ggplot(head(data, 80), aes(x=day)) +
geom_bar( aes(y=temperature), stat="identity", size=.1, fill=temperatureColor, color="black", alpha=.4) +
geom_line( aes(y=price / coeff), size=2, color=priceColor) +
scale_y_continuous(
# Features of the first axis
name = "Temperature (Celsius Â°)",
# Add a second axis and specify its features
sec.axis = sec_axis(~.*coeff, name="Price ($)")
) +
theme_ipsum() +
theme(
axis.title.y = element_text(color = temperatureColor, size=13),
axis.title.y.right = element_text(color = priceColor, size=13)
) +
ggtitle("Temperature down, price up")
# Value used to transform the data
coeff <- 10
# A few constants
temperatureColor <- "#69b3a2"
priceColor <- rgb(0.2, 0.6, 0.9, 1)
ggplot(head(data, 80), aes(x=day)) +
geom_bar( aes(y=temperature), stat="identity", size=.1, fill=temperatureColor, color="black", alpha=.4) +
geom_line( aes(y=price / coeff), size=2, color=priceColor) +
scale_y_continuous(
# Features of the first axis
name = "Temperature (Celsius Â°)",
# Add a second axis and specify its features
sec.axis = sec_axis(~.*coeff, name="Price ($)")
) +
theme_ipsum() +
theme(
axis.title.y = element_text(color = temperatureColor, size=13),
axis.title.y.right = element_text(color = priceColor, size=13)
) +
ggtitle("Temperature down, price up")
ggplot(head(data, 80), aes(x=day))
# Build dummy data
data <- data.frame(
day = as.Date("2019-01-01") + 0:99,
temperature = runif(100) + seq(1,100)^2.5 / 10000,
price = runif(100) + seq(100,1)^1.5 / 10
)
# Value used to transform the data
coeff <- 10
# A few constants
temperatureColor <- "#69b3a2"
priceColor <- rgb(0.2, 0.6, 0.9, 1)
ggplot(head(data, 80), aes(x=day)) +
geom_bar( aes(y=temperature), stat="identity", size=.1, fill=temperatureColor, color="black", alpha=.4) +
geom_line( aes(y=price / coeff), size=2, color=priceColor) +
scale_y_continuous(
# Features of the first axis
name = "Temperature (Celsius Â°)",
# Add a second axis and specify its features
sec.axis = sec_axis(~.*coeff, name="Price ($)")
) +
theme_ipsum() +
theme(
axis.title.y = element_text(color = temperatureColor, size=13),
axis.title.y.right = element_text(color = priceColor, size=13)
) +
ggtitle("Temperature down, price up")
ggplot(head(data, 80), aes(x=day)) +
geom_bar( aes(y=temperature), stat="identity", size=.1, fill=temperatureColor, color="black", alpha=.4) +
geom_line( aes(y=price / coeff), size=2, color=priceColor) +
scale_y_continuous(
# Features of the first axis
name = "Temperature (Celsius Â°)",
# Add a second axis and specify its features
sec.axis = sec_axis(~.*coeff, name="Price ($)")
) +
theme(
axis.title.y = element_text(color = temperatureColor, size=13),
axis.title.y.right = element_text(color = priceColor, size=13)
) +
ggtitle("Temperature down, price up")
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
#
#
# ## Plot
# p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
#   scale_fill_viridis_d()+
#   geom_violin()+
#   geom_hline(yintercept = median(mat1$prob), linetype = 3) +
#   theme_minimal(base_size = 14) +
#   labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))
# return(p)
return(mat1)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
merge(plot_violin_tissues, all_medsd_lambda)
plot_violin_tissues <- merge(plot_violin_tissues, all_medsd_lambda)
mat1 <- merge(plot_violin_tissues, all_medsd_lambda)
ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d()+
geom_violin()+
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p <- ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d()+
geom_violin()+
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
p + geom_point(aes(y = lambda))
p
mat1$lambda
scale(mat1$lambda)
(mat1$lambda - min(mat1$lambda)) / (max(mat1$lambda) - min(mat1$lambda))
mat1$minmaxlambda <- (mat1$lambda - min(mat1$lambda)) / (max(mat1$lambda) - min(mat1$lambda))
p + geom_point(aes(y = minmaxlambda))
mat1
mat1$lambda
View(mat1)
p <- ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d()+
geom_violin()+
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue", x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p + geom_point(aes(y = minmaxlambda))
p + geom_point(aes(y = minmaxlambda)) +
scale_y_continuous(
# Features of the first axis
name = "Probability of being hv",
# Add a second axis and specify its features
sec.axis = sec_axis(~.*minmaxlambda, name="minmaxlambda")
)
p + geom_point(aes(y = minmaxlambda)) +
scale_y_continuous(
# Features of the first axis
name = "Probability of being hv",
# Add a second axis and specify its features
sec.axis = sec_axis(~.minmaxlambda, name="minmaxlambda")
)
p + geom_point(aes(y = minmaxlambda)) +
scale_y_continuous(
# Features of the first axis
name = "Probability of being hv",
# Add a second axis and specify its features
sec.axis = sec_axis(name="minmaxlambda")
)
head(mat1)
range_prob <- range(mat1$prob, na.rm = TRUE)
range_lambda <- range(mat1$lambda, na.rm = TRUE)
range_prob
range_lambda
# slope and intercept for mapping
a <- diff(range_lambda) / diff(range_prob)
b <- range_lambda[1] - a * range_prob[1]
a
b
p <- ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue",
x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(
name = "Probability of being hv",
sec.axis = sec_axis(~ a * . + b, name = "lambda")
)
p + geom_point(aes(y = (lambda - b) / a), color = "red", size = 1)
p <- ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue",
x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(
name = "Probability of being hv",
sec.axis = sec_axis(~ a * . + b, name = "lambda")
) +
geom_point(aes(y = (lambda - b) / a), color = "red", size = 5)
p
}
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
## Plot on 2 axes p(hv) and lambda
range_prob = range(mat1$prob, na.rm = TRUE)
range_lambda = range(mat1$lambda, na.rm = TRUE)
# slope and intercept for mapping
a = diff(range_lambda) / diff(range_prob)
b = range_lambda[1] - a * range_prob[1]
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue",
x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(
name = "Probability of being hv",
sec.axis = sec_axis(~ a * . + b, name = "lambda")
) +
geom_point(aes(y = (lambda - b) / a), color = "red", size = 5)
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
mat1 = merge(plot_violin_tissues, all_medsd_lambda)
## Plot on 2 axes p(hv) and lambda
range_prob = range(mat1$prob, na.rm = TRUE)
range_lambda = range(mat1$lambda, na.rm = TRUE)
# slope and intercept for mapping
a = diff(range_lambda) / diff(range_prob)
b = range_lambda[1] - a * range_prob[1]
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue",
x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(
name = "Probability of being hv",
sec.axis = sec_axis(~ a * . + b, name = "lambda")
) +
geom_point(aes(y = (lambda - b) / a), color = "red", size = 5)
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
library(here)
source(here("05_hvCpGalgorithm", "quiet_library.R"))
parent_dir <- here("05_hvCpGalgorithm/resultsDir/Atlas/Atlas10X_tissueAnalysis/")
rds_files <- list.files(parent_dir, pattern = "\\.rds$", recursive = TRUE, full.names = TRUE)
## Lambdas
all_medsd_lambda <- read.table(here("04_prepAtlas/all_medsd_lambda.tsv"), sep = "\t", header = T)
#################
## Violin plot ##
#################
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
mat1 = merge(mat1, all_medsd_lambda)
## Plot on 2 axes p(hv) and lambda
range_prob = range(mat1$prob, na.rm = TRUE)
range_lambda = range(mat1$lambda, na.rm = TRUE)
# slope and intercept for mapping
a = diff(range_lambda) / diff(range_prob)
b = range_lambda[1] - a * range_prob[1]
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue",
x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(
name = "Probability of being hv",
sec.axis = sec_axis(~ a * . + b, name = "lambda")
) +
geom_point(aes(y = (lambda - b) / a), color = "red", size = 5, show.legend = FALSE)
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
plot_violin_tissues
plot_violin_tissues
plot_violin_tissues + geom_boxplot()
plot_violin_tissues + geom_boxplot(width = .2)
plot_violin_tissues + geom_boxplot(width = .2, alpha = .5)
plot_violin_tissues + geom_boxplot(width = .2, alpha = .5)
plot_violin_tissues + geom_boxplot(width = .2, fill = "white")
plot_violin_tissues + geom_boxplot(width = .2, fill = "white", outliers = F)
plot_violin_tissues + geom_boxplot(width = .2, fill = "grey", outliers = F)
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
mat1 = merge(mat1, all_medsd_lambda)
## Plot on 2 axes p(hv) and lambda
range_prob = range(mat1$prob, na.rm = TRUE)
range_lambda = range(mat1$lambda, na.rm = TRUE)
# slope and intercept for mapping
a = diff(range_lambda) / diff(range_prob)
b = range_lambda[1] - a * range_prob[1]
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_boxplot(width = .2, fill = "white", outliers = F)    geom_hline(yintercept = median(mat1$prob), linetype = 3) +
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
makeViolin <- function(size = 10, rds_files){
set.seed(1234)
mat1 = readRDS(rds_files[1])
mat1 = mat1[sample(nrow(mat1), size = size), ,drop = F]
pb <- progress_bar$new(total = length(rds_files), format = "ðŸ“¦ :current/:total [:bar] :percent")
for (file in rds_files) {
mat = readRDS(file)  # rows ~100000, cols ~46
## Select a sub sample because it's too big otherwise
mat1 = rbind(mat1, mat[sample(nrow(mat), size = size), ,drop = F])
pb$tick()
}
mat1 = reshape2::melt(mat1)
names(mat1) = c("pos", "dataset", "prob")
## Exponentialise because it is on a log scale
mat1$prob <- exp(mat1$prob)
## Add information
SupTab1_Loyfer2023 = read.csv(here("05_hvCpGalgorithm/dataPrev/SupTab1_Loyfer2023.csv"))
mat1$Germ.layer = SupTab1_Loyfer2023$Germ.layer[
match(mat1$dataset, paste0(SupTab1_Loyfer2023$Source.Tissue, " - ", SupTab1_Loyfer2023$Cell.type))]
mat1 = merge(mat1, all_medsd_lambda)
## Plot on 2 axes p(hv) and lambda
range_prob = range(mat1$prob, na.rm = TRUE)
range_lambda = range(mat1$lambda, na.rm = TRUE)
# slope and intercept for mapping
a = diff(range_lambda) / diff(range_prob)
b = range_lambda[1] - a * range_prob[1]
p = ggplot(mat1, aes(x = dataset, y = prob, fill = Germ.layer)) +
scale_fill_viridis_d() +
geom_violin() +
geom_boxplot(width = .2, fill = "white", outliers = F) +
geom_hline(yintercept = median(mat1$prob), linetype = 3) +
theme_minimal(base_size = 14) +
labs(title = "Probability of being hypervariable per tissue",
x = "Dataset", y = "p(hv)") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(
name = "Probability of being hv",
sec.axis = sec_axis(~ a * . + b, name = "lambda")
) +
geom_point(aes(y = (lambda - b) / a), color = "red", size = 5, show.legend = FALSE)
return(p)
}
plot_violin_tissues <- makeViolin(rds_files = rds_files, size = 10)
plot_violin_tissues
plot_violin_tissues
