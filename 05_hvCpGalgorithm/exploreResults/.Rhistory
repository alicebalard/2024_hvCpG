## Add previous MEs including Maria's results if not sourced yet
if (!exists("KesslerSIV_GRanges_hg38")) {
source(here("05_hvCpGalgorithm/exploreResults/prepPreviousSIV.R"))
}
system.time(Atlas_dt <- prepAtlasdt(file))
print("Number of CpG tested:")
print(nrow(Atlas_dt))
print(paste0("Saving results for ", file, "in ", here(paste0("gitignore/fullres_", file))))
saveRDS(Atlas_dt, file = here(paste0("gitignore/fullres_", file)))
print("Saved")
}
}
##################
## 1_byDevLayer ## --> not very useful
##################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_1_byDevLayer.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_1_byDevLayer")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_1_byDevLayer",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut in 3 groups (germ layers)")
}
#####################
## 2_rmMultSamples ##
#####################
## Some individuals have multiple cells sampled. Does that affect our results? NOPE
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_2_rmMultSamples.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_2_rmMultSamples")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_2_rmMultSamples",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets keeping one sample/individual only")
}
###########################
## 3_correspMariaTissues ## --> very similar than full atlas
###########################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_3_correspMariaTissues.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X")),
Y = readRDS(here("gitignore/fullres_Atlas10X_3_correspMariaTissues")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_3_correspMariaTissues",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets with only cells found in array")
}
################
## Sex effect ##
################
## 1/ male
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_4_vs_5_maleEffect.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X_4_maleOnly")),
Y = readRDS(here("gitignore/fullres_Atlas10X_5_allButMaleOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_4_vs_5_maleEffect",
xlab = "Pr(hv) calculated on WGBS atlas males only datasets",
ylab = "Pr(hv) calculated on WGBS atlas all but males only datasets")
}
## 2/ female
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_6_vs_7_femaleEffect.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X_6_femaleOnly")),
Y = readRDS(here("gitignore/fullres_Atlas10X_7_allButfemaleOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_6_vs_7_femaleEffect",
xlab = "Pr(hv) calculated on WGBS atlas females only datasets",
ylab = "Pr(hv) calculated on WGBS atlas all but females only datasets")
}
################
## 8_byTissue ##
################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_8_byTissue.pdf")))){
## Cut by tissue rather than by cell type. Is is closer to array data?
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_8_byTissue")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_8_byTissue",
xlab = "Pr(hv) calculated on WGBS atlas datasets (cut by cell types)",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut by tissues")
}
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Array_vs_8_byTissue.pdf")))){
makeCompPlot(
X = resCompArray,
Y = readRDS(here::here("gitignore/fullres_Atlas10X_8_byTissue")),
whichAlphaX = "alpha_array_all",
whichAlphaY = "alpha",
title = "Array_vs_8_byTissue",
xlab = "Pr(hv) calculated on array datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut by tissues")
}
#########################
## 9_immune cells only ##
#########################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_9_immuneOnly.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_9_immuneOnly",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets, immune cells only")
}
#############################
## 10_immune cells removed ##
#############################
## Hypothesis testing:
## Prediction 1:
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_10_vs_9_immuneEffect.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_10_vs_9_immuneEffect",
xlab = "Pr(hv) calculated on WGBS atlas datasets, immune cells removed",
ylab = "Pr(hv) calculated on WGBS atlas datasets, only immune cells")
}
Z_inner_immvsnoimm <- makeZ_inner(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha")
stable <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
cellUniversal <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
immune <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
rest <-  Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
message(paste0("We found ",
length(stable), " (", round(length(stable)/length(Z_inner_immvsnoimm$name)*100), "%) stable CpGs, ",
length(cellUniversal), " (", round(length(cellUniversal)/length(Z_inner_immvsnoimm$name)*100), "%) cell universal hvCpGs, ",
length(immune), " (", round(length(immune)/length(Z_inner_immvsnoimm$name)*100), "%) immune cell hvCpGs and ",
length(rest), " (", round(length(rest)/length(Z_inner_immvsnoimm$name)*100), "%) hvCpGs undetected in immune cells, out of a total of ",
length(Z_inner_immvsnoimm$name), " CpGs investigated"))
## We found 19672473 (86%) stable CpGs, 1047081 (5%) cell universal hvCpGs and 1464480 (6%) immune cell hvCpGs, out of a total of 22805115 CpGs investigated
## Test enrichment in the 3 categories
## Create GRange objects
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
gr_stable <- makeGR_CpGset(stable)
?great
if (!file.exists(here("gitignore/res_cellUniversal.RDS"))){
gr_cellUniversal <- makeGR_CpGset(cellUniversal)
res_cellUniversal <- great(gr_cellUniversal, "msigdb:C5", "hg38", background = gr_bgr)
saveRDS(res_cellUniversal, file = here("gitignore/res_cellUniversal.RDS"))
}
if (!file.exists(here("gitignore/res_cellUniversal.RDS"))){
gr_cellUniversal <- makeGR_CpGset(cellUniversal)
res_cellUniversal <- great(gr_cellUniversal, "GO:BP", "hg38", background = gr_bgr)
saveRDS(res_cellUniversal, file = here("gitignore/res_cellUniversal.RDS"))
}
immune
gr_immune <- makeGR_CpGset(immune)
gr_immune
job = submitGreatJob(gr_immune, genome = "hg38")
length(gr_immune)
gr_immune
res_immune <- great(gr = gr_immune[1:100],
gene_sets = "GO:BP",
tss_source = "hg38",
background = gr_bgr)
here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS"))
s = "immune"
gr <- makeGR_CpGset(get(x))
gr <- makeGR_CpGset(get(s))
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
## Create GRange objects
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
Z_inner_immvsnoimm <- makeZ_inner(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha")
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
## restrict
cellUniversal <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.9 & Z_inner_immvsnoimm$alpha_Y > 0.9]
immune <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.9]
for (x in c("immune", "cellUniversal")){
if (!file.exists(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))){
gr <- makeGR_CpGset(get(x))
res <- great(gr, "C5", "hg38", background = gr_bgr)
saveRDS(res, file = here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))
}
}
library(GenomicRanges)
# Merge adjacent CpGs into intervals (min.gapwidth = 0 means only diff==1 merges)
gr_fg_compact <- reduce(gr,     min.gapwidth = 0L)
gr_bg_compact <- reduce(gr_bgr, min.gapwidth = 0L)  # huge speed-up
gr_bgr <- reduce(gr_bgr, min.gapwidth = 0L)  # huge speed-up
length(gr)           # 79,036 single CpGs
length(gr_fg_compact)  # often much smaller
length(gr_bgr)       # 22,805,115 single CpGs
if (!file.exists(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))){
gr <- makeGR_CpGset(get(x))
res <- great(gr, "C5", "hg38", background = gr_bgr)
saveRDS(res, file = here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))
}
# Merge adjacent CpGs into intervals (min.gapwidth = 0 means only diff==1 merges)
gr_bgr <- reduce(gr_bgr, min.gapwidth = 1L)  # huge speed-up
# Are there any adjacent CpGs?
by_chr <- split(start(gr), seqnames(gr))
adj_counts <- vapply(by_chr,adj_counts <- vapply(by_chr, function(pos) sum(diff(sort(pos)) == 1), integer(1))
by_chr <- split(start(gr), seqnames(gr))
by_chr <- split(start(gr_bgr), seqnames(gr_bgr))
adj_counts <- vapply(by_chr,adj_counts <- vapply(by_chr, function(pos) {
sum(diff(sort(pos)) == 1), integer(1))})
# Are there any adjacent CpGs?
by_chr <- split(start(gr_bgr), seqnames(gr_bgr))
adj_counts <- vapply(by_chr,adj_counts <- vapply(by_chr, function(pos) sum(diff(sort(pos)) == 1), integer(1)))
adj_counts  # if zeros everywhere, no adjacency exists
###################################################################
## Plot secondary analyses results of algorithm ran on atlas data ##
####################################################################
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
#if (!exists("resCompArray")) {
#  source(here("05_hvCpGalgorithm/exploreResults/S02_analyseResultsArray_local.R"))
#}
x <- immune
x <- "immune"
readRDS(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))
res = readRDS(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))
res
res@table
res@table$p_adjust
top_n(res@table$p_adjust, 500)
arrange(res@table$p_adjust)
head(res@table$p_adjust)
top_n(res@table, wt = p_adjust)
top_n(res@table,n = 10, wt = p_adjust)
bottom_n(res@table,n = 10, wt = p_adjust)
?top_n
top_n(-res@table,n = 10, wt = p_adjust)
top_n(res@table,n = -10, wt = p_adjust)
## Plot simplify GO for the top 500 more significant regions
for (x in c("cellUniversal", "immune")){
if (!file.exists(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/plot_", x, ".pdf")))){
res = readRDS(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))
tab = top_n(res@table,n = -500, wt = p_adjust) ## 500 lower p-values
pdf(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/plot_", x, "_heatmap.pdf")), width = 8, height = 6)
simplifyEnrichment::simplifyGO(mat = tab$id)
dev.off()
}
}
N=10
paste0(N, "coucou")
readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/immune100bp.RDS"))
immun100 <- readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/immune100bp.RDS"))
immune50 <- readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/immune.RDS"))
immune50
immun100
immune50@table
immune50@table %>% nrow()
immune1-0@table %>% nrow()
immune100@table %>% nrow()
immune100@table %>% nrow()
immune100 <- readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/immune100bp.RDS"))
immune50 <- readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/immune.RDS"))
immune50@table %>% nrow()
immune100@table %>% nrow()
cellUniversaltop <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.7 & Z_inner_immvsnoimm$alpha_Y > 0.7]
immunetop <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.7]
###################################################################
## Plot secondary analyses results of algorithm ran on atlas data ##
####################################################################
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
tab$id
x= "immune"
res = readRDS(here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS")))
res
tab = res@table
tab
library(org.Hs.eg.db)
simplifyGOterms(goterms=head(tab$id, 10), maxOverlap= 0.1, ontology='BP', go2allEGs= org.Hs.egGO2ALLE)
library(compEpiTools)
install.packages("compEpiTools")
BiocManager::install("compEpiTools")
library(compEpiTools)
simplifyGOterms(goterms=head(tab$id, 10), maxOverlap= 0.1, ontology='BP', go2allEGs= org.Hs.egGO2ALLE)
library(org.Hs.eg.db)
org.Hs.eg.db
simplifyGOterms(goterms=head(tab$id, 10), maxOverlap= 0.1, ontology='BP', go2allEGs= org.Hs.egGO)
simplifyGOterms(goterms=head(tab$id, 10), maxOverlap= 0.1, ontology='BP')
simplifyGOterms(goterms=head(tab$id, 10), maxOverlap= 0.1, ontology='BP', go2allEGs = org.Hs.egGO2ALLEGS)
goterms=head(tab$id, 10)
goterms
simplifyGOterms(goterms=head(tab$id, 10), maxOverlap= 0.1, ontology='BP', go2allEGs = org.Hs.egGO2ALLEGS)
simplifyGOterms_immune <- simplifyGOterms(goterms=tab$id, maxOverlap= 0.1, ontology='BP', go2allEGs = org.Hs.egGO2ALLEGS)
## pruning poorly informative and redundant enriched terms
simplifyGOterms_immune <- simplifyGOterms(goterms=head(tab$id, 100), maxOverlap= 0.1, ontology='BP',
go2allEGs = org.Hs.egGO2ALLEGS)
length(tab$id)
length(simplifyGOterms_immune)
## pruning poorly informative and redundant enriched terms
system.time(simplifyGOterms_immune <- simplifyGOterms(goterms=head(tab$id, 1000), maxOverlap= 0.1, ontology='BP',
go2allEGs = org.Hs.egGO2ALLEGS))
length(simplifyGOterms_immune)
8000/60
800/60
simplifyGOterms_immune
## pruning poorly informative and redundant enriched terms
system.time(compEpiTools::simplifyGOterms_immune <- simplifyGOterms(goterms=head(tab$id, 1000), maxOverlap= 0.1, ontology='BP',
go2allEGs = org.Hs.egGO2ALLEGS))
###################################################################
## Plot secondary analyses results of algorithm ran on atlas data ##
####################################################################
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
#if (!exists("resCompArray")) {
#  source(here("05_hvCpGalgorithm/exploreResults/S02_analyseResultsArray_local.R"))
#}
##################################
## Save all data in RDS objects ##
##################################
for (file in list.files(here("05_hvCpGalgorithm/resultsDir/Atlas/"))){
if (!file.exists(here(paste0("gitignore/fullres_", file)))){
## Add previous MEs including Maria's results if not sourced yet
if (!exists("KesslerSIV_GRanges_hg38")) {
source(here("05_hvCpGalgorithm/exploreResults/prepPreviousSIV.R"))
}
system.time(Atlas_dt <- prepAtlasdt(file))
print("Number of CpG tested:")
print(nrow(Atlas_dt))
print(paste0("Saving results for ", file, "in ", here(paste0("gitignore/fullres_", file))))
saveRDS(Atlas_dt, file = here(paste0("gitignore/fullres_", file)))
print("Saved")
}
}
##################
## 1_byDevLayer ## --> not very useful
##################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_1_byDevLayer.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_1_byDevLayer")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_1_byDevLayer",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut in 3 groups (germ layers)")
}
#####################
## 2_rmMultSamples ##
#####################
## Some individuals have multiple cells sampled. Does that affect our results? NOPE
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_2_rmMultSamples.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_2_rmMultSamples")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_2_rmMultSamples",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets keeping one sample/individual only")
}
###########################
## 3_correspMariaTissues ## --> very similar than full atlas
###########################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_3_correspMariaTissues.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X")),
Y = readRDS(here("gitignore/fullres_Atlas10X_3_correspMariaTissues")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_3_correspMariaTissues",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets with only cells found in array")
}
################
## Sex effect ##
################
## 1/ male
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_4_vs_5_maleEffect.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X_4_maleOnly")),
Y = readRDS(here("gitignore/fullres_Atlas10X_5_allButMaleOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_4_vs_5_maleEffect",
xlab = "Pr(hv) calculated on WGBS atlas males only datasets",
ylab = "Pr(hv) calculated on WGBS atlas all but males only datasets")
}
## 2/ female
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_6_vs_7_femaleEffect.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X_6_femaleOnly")),
Y = readRDS(here("gitignore/fullres_Atlas10X_7_allButfemaleOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_6_vs_7_femaleEffect",
xlab = "Pr(hv) calculated on WGBS atlas females only datasets",
ylab = "Pr(hv) calculated on WGBS atlas all but females only datasets")
}
################
## 8_byTissue ##
################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_8_byTissue.pdf")))){
## Cut by tissue rather than by cell type. Is is closer to array data?
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_8_byTissue")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_8_byTissue",
xlab = "Pr(hv) calculated on WGBS atlas datasets (cut by cell types)",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut by tissues")
}
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Array_vs_8_byTissue.pdf")))){
makeCompPlot(
X = resCompArray,
Y = readRDS(here::here("gitignore/fullres_Atlas10X_8_byTissue")),
whichAlphaX = "alpha_array_all",
whichAlphaY = "alpha",
title = "Array_vs_8_byTissue",
xlab = "Pr(hv) calculated on array datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut by tissues")
}
#########################
## 9_immune cells only ##
#########################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_9_immuneOnly.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_9_immuneOnly",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets, immune cells only")
}
#############################
## 10_immune cells removed ##
#############################
## Hypothesis testing:
## Prediction 1:
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_10_vs_9_immuneEffect.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_10_vs_9_immuneEffect",
xlab = "Pr(hv) calculated on WGBS atlas datasets, immune cells removed",
ylab = "Pr(hv) calculated on WGBS atlas datasets, only immune cells")
}
system.time(Z_inner_immvsnoimm <- makeZ_inner(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha")) ## takes 2 minutes
readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/simplifiedGOterms_immune.RDS")
readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/simplifiedGOterms_immune.RDS")
readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/simplifiedGOterms_immune.RDS"))
library(here)
simplifiedGOterms_immune <- readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/simplifiedGOterms_immune.RDS"))
simplifiedGOterms_cellUniversal <- readRDS(here("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/simplifiedGOterms_cellUniversal.RDS"))
head(simplifiedGOterms_immune)
simplifiedGOterms_immune
simplifiedGOterms_immune@table
