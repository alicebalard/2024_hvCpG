installed <- requireNamespace(pkg, quietly = TRUE)
# Install if missing
if (!installed) {
if (!requireNamespace("BiocManager", quietly = TRUE)) {
suppressMessages(suppressWarnings(
install.packages("BiocManager", repos = "https://cloud.r-project.org", quiet = TRUE)
))
}
cran_pkgs <- suppressMessages(available.packages(repos = "https://cloud.r-project.org"))
if (pkg %in% rownames(cran_pkgs)) {
suppressMessages(suppressWarnings(
install.packages(pkg, repos = "https://cloud.r-project.org", quiet = TRUE)
))
} else {
suppressMessages(suppressWarnings(
BiocManager::install(pkg, ask = FALSE, update = FALSE, quiet = TRUE)
))
}
}
# Load silently
suppressPackageStartupMessages(
suppressMessages(
suppressWarnings(
library(pkg, character.only = TRUE, quietly = TRUE, warn.conflicts = FALSE)
)
)
)
# Get version after loading
version <- as.character(utils::packageVersion(pkg))
# Print only our message
cat(sprintf("Load package %s v%s\n", pkg, version))
}
quiet_library_all <- function(pkgs) {
invisible(lapply(pkgs, quiet_library))
}
quiet_library_all(
c("dplyr", "data.table", "matrixStats", "reshape2","tidyr", "tibble", ## data formatting
"parallel", "rhdf5",  "stringr", ## data handling
"ggplot2", "progress", "ggrastr", "Cairo", "ggrepel", "scales",
"UpSetR", "gridGraphics", "grid", "cowplot","ggExtra",  "ggVennDiagram", "geomtextpath", ## graphical
"boot", "emmeans", ## stats
"methylKit", "rtracklayer", "IlluminaHumanMethylation450kanno.ilmn12.hg19",
"IlluminaHumanMethylationEPICanno.ilm10b4.hg19", "GenomicRanges", "rGREAT", ## methylation
"testthat" # grammar & packaging
))
## NB: not all libraries are necessary; to clean when packaging
rm(quiet_library_all, quiet_library)
libLoaded = TRUE
set.seed(123)
gr = randomRegions(nr = 1000, genome = "hg19")
gr
gr = randomRegions(nr = 1000, genome = "hg38")
gr
## Perform local GREAT with great()
res = great(gr, "MSigDB:H", "txdb:hg38")
res
rGREAT:::BIOC_ANNO_PKGS$txdb
tb = getEnrichmentTable(res)
head(tb)
plotVolcano(res)
plotRegionGeneAssociations(res)
shinyReport(res)
plotVolcano(res)
head(tb)
rest
Z_inner_immvsnoimm$name
strsplit(Z_inner_immvsnoimm$name, "_")
# ids: a character vector like c("chr1_854335","chr1_854471", ...)
chr <- sub("_.+$", "", Z_inner_immvsnoimm$name, perl = TRUE)
chr <- sub("_.+$", "", ids, perl = TRUE)
ids = Z_inner_immvsnoimm$name
pos <- as.integer(sub("^.*_", "", ids, perl = TRUE))
gr_bgr <- GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38"
)
gr_bgr
# Keep standard chroms and enforce style if you like
gr <- keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr) <- "UCSC"   # "chr1", "chr2", ...
gr
?keepStandardChromosomes
gr
gr@seqnames
unique(gr@seqnames)
ids =
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr_bgr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
gr_bgr
rest
gr_stable <- makeGR_CpGset(stable)
gr_cellUniversal <- <- makeGR_CpGset(cellUniversal)
gr_cellUniversal <- makeGR_CpGset(cellUniversal)
gr_immune <- makeGR_CpGset(immune)
gr_rest <- makeGR_CpGset(rest)
res_stable <- great(
regions = gr_stable,
ontology = "GO:BP",
txdb = TxDb.Hsapiens.UCSC.hg38.knownGene,
orgdb = org.Hs.eg.db,
background = gr_bgr,          # custom background
exclude = "gap"               # exclude gaps
)
res_stable <- great(
gr = gr_stable,
ontology = "GO:BP",
txdb = TxDb.Hsapiens.UCSC.hg38.knownGene,
orgdb = org.Hs.eg.db,
background = gr_bgr,          # custom background
exclude = "gap"               # exclude gaps
)
res_stable <- great(
gr = gr_stable,
gene_sets = "MSigDB:H",
tss_source = "txdb:hg38",
background = gr_bgr,          # custom background
exclude = "gap"               # exclude gaps
)
tb <- getEnrichmentTable(res_stable)
# Volcano-style summary (Binomial test vs fold-enrichment)
plotVolcano(res_stable)
head(tb)
View(tb)
# compute gene ratio as observed_in_gene_count / term_gene_count
tb$GeneRatio <- with(tb, observed_in_gene_count / term_gene_count)
tb$observed_region_hits
head(tb)
ggplot(tb, aes(x = genome_fraction, y = id)) +
geom_point(aes(size = observed_gene_hits, color = -log10(p_adjust))) +
scale_color_viridis_c(name = expression(-log[10]~FDR)) +
scale_size_continuous(name = "Observed genes") +
labs(x = "GeneRatio", y = NULL, title = "GO Biological Process enrichment (GREAT)") +
theme_minimal(base_size = 12)
res_immune <- great(
gr = gr_immune,
gene_sets = "MSigDB:H",
tss_source = "txdb:hg38",
background = gr_bgr,          # custom background
exclude = "gap"               # exclude gaps
)
tb <- getEnrichmentTable(res_immune)
res_immune
gr_immune
res_immune <- great(
gr = head(gr_immune),
gene_sets = "GO",
tss_source = "txdb:hg38",
background = gr_bgr,          # custom background
exclude = "gap"               # exclude gaps
)
res_immune <- great(
gr = head(gr_immune),
gene_sets = "GO:BP",
tss_source = "txdb:hg38",
background = gr_bgr,          # custom background
exclude = "gap"               # exclude gaps
)
####################################################################
## Plot secondary analyses results of algorithm ran on atlas data ##
####################################################################
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
if (!exists("resCompArray")) {
source(here("05_hvCpGalgorithm/exploreResults/S02_analyseResultsArray_local.R"))
}
Z_inner_immvsnoimm <- makeZ_inner(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha")
stable <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
cellUniversal <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
immune <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
rest <-  Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
message(paste0("We found ",
length(stable), " (", round(length(stable)/length(Z_inner_immvsnoimm$name)*100), "%) stable CpGs, ",
length(cellUniversal), " (", round(length(cellUniversal)/length(Z_inner_immvsnoimm$name)*100), "%) cell universal hvCpGs, ",
length(immune), " (", round(length(immune)/length(Z_inner_immvsnoimm$name)*100), "%) immune cell hvCpGs and ",
length(rest), " (", round(length(rest)/length(Z_inner_immvsnoimm$name)*100), "%) hvCpGs undetected in immune cells, out of a total of ",
length(Z_inner_immvsnoimm$name), " CpGs investigated"))
## We found 19672473 (86%) stable CpGs, 1047081 (5%) cell universal hvCpGs and 1464480 (6%) immune cell hvCpGs, out of a total of 22805115 CpGs investigated
## Test enrichment in the 3 catego
## Create GRange objects
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr_bgr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
res_immune <- great(gr_immune, "GO:BP", "hg38")
gr_immune
gr_immune <- makeGR_CpGset(immune)
## Create GRange objects
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
gr_immune <- makeGR_CpGset(immune)
res_immune <- great(gr_immune, "GO:BP", "hg38")
res_immune
res_immune <- great(gr_immune, "GO:BP", "hg38")
res_immune
tb <- getEnrichmentTable(res_immune)
names(tb)
ggplot(tb, aes(x = genome_fraction, y = id)) +
geom_point(aes(size = observed_gene_hits, color = -log10(p_adjust))) +
scale_color_viridis_c(name = expression(-log[10]~FDR)) +
scale_size_continuous(name = "Observed genes") +
labs(x = "GeneRatio", y = NULL, title = "GO Biological Process enrichment (GREAT)") +
theme_minimal(base_size = 12)
tb
head(tb)
View(tb)
plotVolcano(tb)
plotVolcano(res_immune)
head(tb)
res_immune
res_immune <- great(gr_immune, "C5", "hg38")
res_immune <- great(gr_immune, "C5", "hg38", background = gr_bgr)
####################################################################
## Plot secondary analyses results of algorithm ran on atlas data ##
####################################################################
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
if (!exists("resCompArray")) {
source(here("05_hvCpGalgorithm/exploreResults/S02_analyseResultsArray_local.R"))
}
## Prediction 1:
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_10_vs_9_immuneEffect.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_10_vs_9_immuneEffect",
xlab = "Pr(hv) calculated on WGBS atlas datasets, immune cells removed",
ylab = "Pr(hv) calculated on WGBS atlas datasets, only immune cells")
}
Z_inner_immvsnoimm <- makeZ_inner(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha")
stable <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
cellUniversal <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
immune <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
rest <-  Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
message(paste0("We found ",
length(stable), " (", round(length(stable)/length(Z_inner_immvsnoimm$name)*100), "%) stable CpGs, ",
length(cellUniversal), " (", round(length(cellUniversal)/length(Z_inner_immvsnoimm$name)*100), "%) cell universal hvCpGs, ",
length(immune), " (", round(length(immune)/length(Z_inner_immvsnoimm$name)*100), "%) immune cell hvCpGs and ",
length(rest), " (", round(length(rest)/length(Z_inner_immvsnoimm$name)*100), "%) hvCpGs undetected in immune cells, out of a total of ",
length(Z_inner_immvsnoimm$name), " CpGs investigated"))
## We found 19672473 (86%) stable CpGs, 1047081 (5%) cell universal hvCpGs and 1464480 (6%) immune cell hvCpGs, out of a total of 22805115 CpGs investigated
## Test enrichment in the 3 categories
## Create GRange objects
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
gr_stable <- makeGR_CpGset(stable)
gr_cellUniversal <- makeGR_CpGset(cellUniversal)
gr_immune <- makeGR_CpGset(immune)
gr_rest <- makeGR_CpGset(rest)
res_immune <- great(gr_immune, "C5", "hg38", background = gr_bgr)
res_immune
res_immune
res_immune <- great(gr_immune, "C5", "hg38", background = gr_bgr)
####################################################################
library(here)
if (!exists("libLoaded")) {
source(here("05_hvCpGalgorithm", "quiet_library.R"))
}
if (!exists("functionsLoaded")) {
source(here("05_hvCpGalgorithm/exploreResults", "functions.R"))
}
if (!exists("resCompArray")) {
source(here("05_hvCpGalgorithm/exploreResults/S02_analyseResultsArray_local.R"))
}
##################################
## Save all data in RDS objects ##
##################################
for (file in list.files(here("05_hvCpGalgorithm/resultsDir/Atlas/"))){
if (!file.exists(here(paste0("gitignore/fullres_", file)))){
## Add previous MEs including Maria's results if not sourced yet
if (!exists("KesslerSIV_GRanges_hg38")) {
source(here("05_hvCpGalgorithm/exploreResults/prepPreviousSIV.R"))
}
system.time(Atlas_dt <- prepAtlasdt(file))
print("Number of CpG tested:")
print(nrow(Atlas_dt))
print(paste0("Saving results for ", file, "in ", here(paste0("gitignore/fullres_", file))))
saveRDS(Atlas_dt, file = here(paste0("gitignore/fullres_", file)))
print("Saved")
}
}
##################
## 1_byDevLayer ## --> not very useful
##################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_1_byDevLayer.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_1_byDevLayer")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_1_byDevLayer",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut in 3 groups (germ layers)")
}
#####################
## 2_rmMultSamples ##
#####################
## Some individuals have multiple cells sampled. Does that affect our results? NOPE
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_2_rmMultSamples.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_2_rmMultSamples")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_2_rmMultSamples",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets keeping one sample/individual only")
}
###########################
## 3_correspMariaTissues ## --> very similar than full atlas
###########################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_3_correspMariaTissues.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X")),
Y = readRDS(here("gitignore/fullres_Atlas10X_3_correspMariaTissues")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_3_correspMariaTissues",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets with only cells found in array")
}
################
## Sex effect ##
################
## 1/ male
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_4_vs_5_maleEffect.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X_4_maleOnly")),
Y = readRDS(here("gitignore/fullres_Atlas10X_5_allButMaleOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_4_vs_5_maleEffect",
xlab = "Pr(hv) calculated on WGBS atlas males only datasets",
ylab = "Pr(hv) calculated on WGBS atlas all but males only datasets")
}
## 2/ female
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_6_vs_7_femaleEffect.pdf")))){
makeCompPlot(
X = readRDS(here("gitignore/fullres_Atlas10X_6_femaleOnly")),
Y = readRDS(here("gitignore/fullres_Atlas10X_7_allButfemaleOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_6_vs_7_femaleEffect",
xlab = "Pr(hv) calculated on WGBS atlas females only datasets",
ylab = "Pr(hv) calculated on WGBS atlas all but females only datasets")
}
################
## 8_byTissue ##
################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_8_byTissue.pdf")))){
## Cut by tissue rather than by cell type. Is is closer to array data?
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_8_byTissue")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_8_byTissue",
xlab = "Pr(hv) calculated on WGBS atlas datasets (cut by cell types)",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut by tissues")
}
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Array_vs_8_byTissue.pdf")))){
makeCompPlot(
X = resCompArray,
Y = readRDS(here::here("gitignore/fullres_Atlas10X_8_byTissue")),
whichAlphaX = "alpha_array_all",
whichAlphaY = "alpha",
title = "Array_vs_8_byTissue",
xlab = "Pr(hv) calculated on array datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets cut by tissues")
}
#########################
## 9_immune cells only ##
#########################
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_0_vs_9_immuneOnly.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_0_vs_9_immuneOnly",
xlab = "Pr(hv) calculated on WGBS atlas datasets",
ylab = "Pr(hv) calculated on WGBS atlas datasets, immune cells only")
}
#############################
## 10_immune cells removed ##
#############################
## Hypothesis testing:
## Prediction 1:
if (!file.exists(file.path(here::here("05_hvCpGalgorithm/figures/correlations/correlation_Atlas_10_vs_9_immuneEffect.pdf")))){
makeCompPlot(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha",
title = "Atlas_10_vs_9_immuneEffect",
xlab = "Pr(hv) calculated on WGBS atlas datasets, immune cells removed",
ylab = "Pr(hv) calculated on WGBS atlas datasets, only immune cells")
}
Z_inner_immvsnoimm <- makeZ_inner(
X = readRDS(here::here("gitignore/fullres_Atlas10X_10_noImmune")),
Y = readRDS(here::here("gitignore/fullres_Atlas10X_9_immuneOnly")),
whichAlphaX = "alpha",
whichAlphaY = "alpha")
stable <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
cellUniversal <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
immune <- Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X < 0.5 & Z_inner_immvsnoimm$alpha_Y > 0.5]
rest <-  Z_inner_immvsnoimm$name[Z_inner_immvsnoimm$alpha_X > 0.5 & Z_inner_immvsnoimm$alpha_Y < 0.5]
message(paste0("We found ",
length(stable), " (", round(length(stable)/length(Z_inner_immvsnoimm$name)*100), "%) stable CpGs, ",
length(cellUniversal), " (", round(length(cellUniversal)/length(Z_inner_immvsnoimm$name)*100), "%) cell universal hvCpGs, ",
length(immune), " (", round(length(immune)/length(Z_inner_immvsnoimm$name)*100), "%) immune cell hvCpGs and ",
length(rest), " (", round(length(rest)/length(Z_inner_immvsnoimm$name)*100), "%) hvCpGs undetected in immune cells, out of a total of ",
length(Z_inner_immvsnoimm$name), " CpGs investigated"))
## We found 19672473 (86%) stable CpGs, 1047081 (5%) cell universal hvCpGs and 1464480 (6%) immune cell hvCpGs, out of a total of 22805115 CpGs investigated
## Test enrichment in the 3 categories
## Create GRange objects
makeGR_CpGset <- function(ids){
chr = sub("_.+$", "", ids, perl = TRUE)
pos = as.integer(sub("^.*_", "", ids, perl = TRUE))
gr = GRanges(
seqnames = Rle(chr),
ranges   = IRanges(start = pos, width = 1),
genome   = "hg38")
gr = keepStandardChromosomes(gr, pruning.mode = "coarse")
seqlevelsStyle(gr) <- "UCSC"   # Keep standard chroms
return(gr)
}
gr_bgr <- makeGR_CpGset(Z_inner_immvsnoimm$name)
gr_stable <- makeGR_CpGset(stable)
?great
if (!file.exists(here("gitignore/res_cellUniversal.RDS"))){
gr_cellUniversal <- makeGR_CpGset(cellUniversal)
res_cellUniversal <- great(gr_cellUniversal, "msigdb:C5", "hg38", background = gr_bgr)
saveRDS(res_cellUniversal, file = here("gitignore/res_cellUniversal.RDS"))
}
if (!file.exists(here("gitignore/res_cellUniversal.RDS"))){
gr_cellUniversal <- makeGR_CpGset(cellUniversal)
res_cellUniversal <- great(gr_cellUniversal, "GO:BP", "hg38", background = gr_bgr)
saveRDS(res_cellUniversal, file = here("gitignore/res_cellUniversal.RDS"))
}
immune
gr_immune <- makeGR_CpGset(immune)
gr_immune
job = submitGreatJob(gr_immune, genome = "hg38")
length(gr_immune)
gr_immune
res_immune <- great(gr = gr_immune[1:100],
gene_sets = "GO:BP",
tss_source = "hg38",
background = gr_bgr)
here(paste0("05_hvCpGalgorithm/exploreResults/annotations_rGREAT/", x, ".RDS"))
s = "immune"
gr <- makeGR_CpGset(get(x))
gr <- makeGR_CpGset(get(s))
