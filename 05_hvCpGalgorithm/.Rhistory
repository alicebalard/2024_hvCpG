}
# Create data.table from named vector
dt <- data.table(
name =   sub("-[0-9]+$", "", names(all_cpg_values)), # just keep the C position instead of C + 1
alpha = as.numeric(all_cpg_values)
)
rm(e, pb, all_cpg_values, obj, file, parent_dir, rdata_files)
#######################################################################
# Parse "chr_pos" in name into chr, start_pos, end_pos. NB: takes a couple of minutes
dt[, c("chr", "pos") := tstrsplit(name, "_", fixed = TRUE)]
# Convert to integer/numeric if not already
dt[, pos := as.integer(pos)]
## Check chromosomes present:
message("Chromosomes in the dataset:")
table(unique(dt$chr))
# Convert chr from "chrN" to  factor
dt[, chr := sub("chr", "", chr)]
dt[, chr := factor(chr, levels = as.character(c(1:22, "X", "Y", "M")))]
## Check chromosomes order:
message("Chromosomes in the dataset:")
table(unique(dt$chr))
## Mark group membership in dt
dt[, group := NA_character_]
dt[name %in% DerakhshanhvCpGs_hg38, group := "hvCpG_Derakhshan"]
dt[name %in% mQTLcontrols_hg38, group := "mQTLcontrols"]
# Compute cumulative position offsets for Manhattan plot
setorder(dt, chr, pos)
offsets <- dt[, .(max_pos = max(pos, na.rm = TRUE)), by = chr]
offsets[, cum_offset := c(0, head(cumsum(as.numeric(max_pos)), -1))]
dt <- merge(dt, offsets[, .(chr, cum_offset)], by = "chr", all.x = TRUE, sort = FALSE)
# Convert to integer/numeric if not already
dt[, cum_offset := as.numeric(cum_offset)]
dt[, pos2 := pos + cum_offset]
return(dt)
}
system.time(Atlas_dt <- prepAtlasdt())
if (exists("doIprepAtlas") && isTRUE(doIprepAtlas)) {
stop("stop here to only prepare atlas_dt")
}
# Compute chromosome centers for x-axis labeling
df2 <- Atlas_dt[, .(center = mean(range(pos2, na.rm = TRUE))), by = chr]
df2 <- merge(data.frame(chr = factor(c(1:22, "X", "Y", "M"), levels=as.character(c(1:22, "X", "Y", "M")))),
df2, by = "chr", all.x = TRUE, sort = TRUE)
df2 <- na.omit(df2)
# Compute chromosome boundaries
df_bounds <- Atlas_dt[, .(min_pos = min(pos2, na.rm = TRUE),
max_pos = max(pos2, na.rm = TRUE)), by = chr]
# Midpoints between chromosomes = where to draw dotted lines
df_bounds[, next_start := data.table::shift(min_pos, n = 1, type = "lead")]
vlines <- df_bounds[!is.na(next_start), .(xintercept = (max_pos + next_start)/2)]
data <- read.table(here("03_prepDatasetsMaria/cistrans_GoDMC_hvCpG_matched_control.txt"), header = T)
x = dico$chrpos_hg38[match(data$hvCpG_name, dico$CpG)]
y = dico$chrpos_hg38[match(data$controlCpG_name, dico$CpG)]
# Build mapping from hvCpG -> control
pairs <- data.frame(
hvCpG = x,
control = y,
stringsAsFactors = FALSE
)
# Merge hvCpG alphas
res <- Atlas_dt[!is.na(group)]
hv_alpha <- res[, c("name", "alpha")]
colnames(hv_alpha) <- c("hvCpG", "alpha_hvCpG")
# Merge control alphas
ctrl_alpha <- res[, c("name", "alpha")]
colnames(ctrl_alpha) <- c("control", "alpha_control")
# Join everything
merged <- pairs %>%
left_join(hv_alpha, by = "hvCpG") %>%
left_join(ctrl_alpha, by = "control") %>%
mutate(diffAlpha=alpha_hvCpG-alpha_control)
merged <- merged %>%
mutate(chr = str_extract(hvCpG, "^chr[0-9XYM]+"))%>%
filter(!is.na(diffAlpha))
ggplot(merged, aes(x="diff", y=diffAlpha))+
geom_jitter(data=merged[merged$diffAlpha>=0,], col="black", alpha=.5)+
geom_jitter(data=merged[merged$diffAlpha<0,], fill="yellow",col="black",pch=21, alpha=.5)+
geom_violin(width=.5, fill = "grey", alpha=.8) +
geom_boxplot(width=0.1, color="black", fill = "grey", alpha=0.8) +
theme_minimal(base_size = 14)+
theme(axis.title.x = element_blank(), axis.text.x = element_blank(), title = element_text(size=10))+
ggtitle("P(hvCpG) minus P(matching control) in atlas")+
ylab("Difference of probability")
# Create GRanges
gr_cpg <- GRanges(
seqnames = paste0("chr", Atlas_dt$chr),
ranges = IRanges(start = Atlas_dt$pos, end = Atlas_dt$pos),
alpha = Atlas_dt$alpha
)
# Import bed file
bed_features <- genomation::readTranscriptFeatures(
"~/Documents/Project_hvCpG/hg38_GENCODE_V47.bed")
# Annotate CpGs and see which regions have higher alpha
anno_result <- genomation::annotateWithGeneParts(
target = gr_cpg, feature = bed_features)
# Combine and expand around the junction
junctions <- suppressWarnings(reduce(c(
flank(exon_ends, width = junction_window, both = TRUE),
flank(intron_starts, width = junction_window, both = TRUE)
)))
# Identify CpGs overlapping exon–intron junctions
is_junction <- countOverlaps(gr_cpg, junctions) > 0
anno_result@perc.of.OlapFeat
anno_result@members
anno_result@dist.to.TSS
anno_result@dist.to.TSS$dist.to.feature
head(anno_result@dist.to.TSS,100)# %>% group_by(feature.name)
head(anno_result@dist.to.TSS,100) %>% group_by(feature.name)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
min(dist.to.feature)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
summarise(min = dist.to.feature)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
reframe(min = dist.to.feature)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
reframe(min = min(dist.to.feature))
test <- head(anno_result, 100)
anno_result@dist.to.TSS
hist(anno_result@dist.to.TSS$target.row)
(anno_result@dist.to.TSS$target.row)
tail(anno_result@dist.to.TSS$target.row)
anno_result@dist.to.TSS$target.row
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
reframe(min = min(dist.to.feature))
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(min = min(dist.to.feature))
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
select(min(dist.to.feature))
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(min(dist.to.feature))
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(dist.to.feature == min(dist.to.feature))
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(dist.to.feature == abs(min(dist.to.feature)))
head(anno_result@dist.to.TSS,100)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(dist.to.feature == abs(min(dist.to.feature)))
head(anno_result@dist.to.TSS,100)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == abs(min(dist.to.feature)))
head(anno_result@dist.to.TSS,100)
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature)))
head(anno_result@dist.to.TSS,100)
region_type <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
## Find the first promoter and the first exon
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature)))
## Find the first promoter and the first exon
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
select(target.row)
## Find the first promoter and the first exon
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
dplyr::select(target.row)
## Find the first promoter and the first exon
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
dplyr::select(target.row) %>% as.vector()
## Find the first promoter and the first exon
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
dplyr::select(target.row)
## Find the first promoter and the first exon
head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
dplyr::select(target.row)
region_type <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
head(region_type)
length(region_type)
rowsFirstToTSS
## Find the first promoter and the first exon
rowsFirstToTSS <- head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
dplyr::select(target.row)
rowsFirstToTSS
## Find the first promoter and the first exon
rowsFirstToTSS <- head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
ungroup() %>% dplyr::select(target.row)
rowsFirstToTSS
## Find the first promoter and the first exon
rowsFirstToTSS <- head(anno_result@dist.to.TSS,100) %>%
group_by(feature.name) %>%
filter(abs(dist.to.feature) == min(abs(dist.to.feature))) %>%
ungroup() %>% dplyr::select(target.row) %>% as.vector()
rowsFirstToTSS
head(anno_result@dist.to.TSS,100)
head(anno_result@dist.to.TSS,100)[c("target.row", "dist.to.feature")]
region_type
gr_cpg
gr_cpg$region_type <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
gr_cpg
table(gr_cpg$region_type)
anno_result@no.of.OlapFeat
# Create GRanges
gr_cpg <- GRanges(
seqnames = paste0("chr", Atlas_dt$chr),
ranges = IRanges(start = Atlas_dt$pos, end = Atlas_dt$pos),
alpha = Atlas_dt$alpha
)
nrow(gr_cpg)
length(gr_cpg)
# Annotate CpGs and see which regions have higher alpha
anno_result <- genomation::annotateWithGeneParts(
target = gr_cpg, feature = bed_features)
length(anno_result@no.of.OlapFeat)
nrow(anno_result@no.of.OlapFeat)
(anno_result@no.of.OlapFeat)
(anno_result@dist.to.TSS)
head(anno_result@dist.to.TSS)
nrow(anno_result@dist.to.TSS)
gr_cpg$region_type <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
(anno_result@dist.to.TSS)
(anno_result@dist.to.TSS$dist.to.feature)
gr_cpg$dist2TSS <- anno_result@dist.to.TSS$dist.to.feature)
gr_cpg$dist2TSS <- anno_result@dist.to.TSS$dist.to.feature
gr_cpg$TSSname <- anno_result@dist.to.TSS$feature.name
table(gr_cpg$region_type)
# Create GRanges of 23036026 CpGs
gr_cpg <- GRanges(
seqnames = paste0("chr", Atlas_dt$chr),
ranges = IRanges(start = Atlas_dt$pos, end = Atlas_dt$pos),
alpha = Atlas_dt$alpha
)
## Add info from annotation to our GRange object
gr_cpg$featureType <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
gr_cpg$dist2TSS <- anno_result@dist.to.TSS$dist.to.feature
gr_cpg$TSSname <- anno_result@dist.to.TSS$feature.name
table(gr_cpg$featureType)
test <- head(gr_cpg, 100)
test
## Find the first promoter and the first exon
test %>%
group_by(TSSname, featureType) %>%
mutate(pos = abs(dist2TSS))
## Find the first promoter and the first exon
test %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = abs(dist2TSS))
test %>%
dplyr::group_by(TSSname, featureType)
test@metadata
test@elementMetadata
## Find the first promoter and the first exon
test@elementMetadata %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = abs(dist2TSS))
## Find the first promoter and the first exon
test@elementMetadata %>% as.data.frame()
## Find the first promoter and the first exon
test@elementMetadata %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = abs(dist2TSS))
## Find the first promoter and the first exon
test@elementMetadata %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = min_rank(abs(dist2TSS)))
## Find the first promoter and the first exon
test@elementMetadata <- test@elementMetadata %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = min_rank(abs(dist2TSS)))
## Find the first promoter and the first exon
test@elementMetadata <- test@elementMetadata %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = min_rank(abs(dist2TSS)))%>% as.data.frame()
test@elementMetadata %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = min_rank(abs(dist2TSS))) %>% as.data.frame()
## Find the first promoter and the first exon
test@elementMetadata %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = min_rank(abs(dist2TSS))) %>% as.data.frame() ->test@elementMetadata
mcols(gr_cpg)
## Find the first promoter and the first exon
mcols(gr_cpg) <- mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
mutate(pos = min_rank(abs(dist2TSS))) %>% data.frame()
gr_cpg
gr_cpg[10:20,]
anno_result@dist.to.TSS$feature.strand
gr_cpg$feature.strand <- anno_result@dist.to.TSS$feature.strand
gr_cpg[10:20,]
anno_result@dist.to.TSS
anno_result@dist.to.TSS[870:878,]
anno_result@dist.to.TSS[152:160,]
gr_cpg
gr_cpg[152:160,]
## Find the first promoter and the first exon by absolute distance
mcols(gr_cpg) <- mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
dplyr::mutate(pos = min_rank(abs(dist2TSS))) %>% data.frame()
gr_cpg
# Create GRanges of 23036026 CpGs
gr_cpg <- GRanges(
seqnames = paste0("chr", Atlas_dt$chr),
ranges = IRanges(start = Atlas_dt$pos, end = Atlas_dt$pos),
alpha = Atlas_dt$alpha
)
## Add info from annotation to our GRange object
gr_cpg$featureType <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
gr_cpg$dist2TSS <- anno_result@dist.to.TSS$dist.to.feature
gr_cpg$TSSname <- anno_result@dist.to.TSS$feature.name
## Find the first promoter and the first exon by absolute distance
mcols(gr_cpg) <- mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
dplyr::mutate(pos = min_rank(abs(dist2TSS))) %>% data.frame()
gr_cpg
## find exon-intron junction
txdb <- txdbmaker::makeTxDbFromGFF("~/Documents/Project_hvCpG/gencode.v38.annotation.gtf", format = "gtf")
exons <- GenomicFeatures::exons(txdb)
introns <- GenomicFeatures::intronsByTranscript(txdb)
# Flatten intron list
introns_flat <- unlist(introns, use.names = FALSE)
# Define a small window (±25 bp) around exon–intron boundaries
junction_window <- 25
# Create exon-intron junction regions (exon ends + intron starts)
exon_ends <- resize(exons, width = 1, fix = "end")
intron_starts <- resize(introns_flat, width = 1, fix = "start")
# Combine and expand around the junction
junctions <- suppressWarnings(reduce(c(
flank(exon_ends, width = junction_window, both = TRUE),
flank(intron_starts, width = junction_window, both = TRUE)
)))
# Identify CpGs overlapping exon–intron junctions
is_junction <- countOverlaps(gr_cpg, junctions) > 0
region_type[is_junction] <- "ex-intr junction"
# add annotation to GRanges object
region_type
# add annotation to GRanges object
gr_cpg$region_type <- region_type
gr_cpg
gr_cpg$featureType == gr_cpg$region_type
gr_cpg$featureType != gr_cpg$region_type
gr_cpg[gr_cpg$featureType != gr_cpg$region_type,]
gr_cpg[gr_cpg$featureType != gr_cpg$region_type,"region_type"]
table(gr_cpg[gr_cpg$featureType != gr_cpg$region_type,"region_type"])
gr_cpg[gr_cpg$featureType != gr_cpg$region_type,]
gr_cpg[gr_cpg$featureType != gr_cpg$region_type,]$region_type
table(gr_cpg[gr_cpg$featureType != gr_cpg$region_type,]$region_type)
rm(bed_features)
rm(anno)
table(gr_cpg[gr_cpg$featureType != gr_cpg$region_type,]$region_type) ## all good
gr_cpg
mcols(gr_cpg)
ggplot(mcols(gr_cpg), aes(x = region_type, y = alpha, fill = region_type)) +
geom_violin()+
geom_boxplot(outlier.size = 0.5, alpha = 0.8, width = .3) +
theme_minimal(base_size = 14) +
labs(y = "p(hv)") +
scale_fill_brewer(palette = "Set2") +
theme(legend.position = "none", axis.title.x = element_blank())
introns_flat
exons
# Create GRanges of 23036026 CpGs
gr_cpg <- GRanges(
seqnames = paste0("chr", Atlas_dt$chr),
ranges = IRanges(start = Atlas_dt$pos, end = Atlas_dt$pos),
alpha = Atlas_dt$alpha
)
anno_result
anno_result@perc.of.OlapFeat
## Add info from annotation to our GRange object
gr_cpg$featureType <- ifelse(anno_result@members[, "prom"] == 1, "promoter",
ifelse(anno_result@members[, "exon"] == 1, "exon",
ifelse(anno_result@members[, "intron"] == 1, "intron", "intergenic")))
exons <- GenomicFeatures::exons(txdb)
introns <- GenomicFeatures::intronsByTranscript(txdb)
# Flatten intron list
introns_flat <- unlist(introns, use.names = FALSE)
# Define a small window (±25 bp) around exon–intron boundaries
junction_window <- 25
# Create exon-intron junction regions (exon ends + intron starts)
exon_ends <- resize(exons, width = 1, fix = "end")
intron_starts <- resize(introns_flat, width = 1, fix = "start")
# Combine and expand around the junction
junctions <- suppressWarnings(reduce(c(
flank(exon_ends, width = junction_window, both = TRUE),
flank(intron_starts, width = junction_window, both = TRUE)
)))
# Identify CpGs overlapping exon–intron junctions
is_junction <- countOverlaps(gr_cpg, junctions) > 0
region_type[is_junction] <- "ex-intr junction"
# add annotation to GRanges object
gr_cpg$preciseFeatureType <- region_type
gr_cpg$dist2TSS <- anno_result@dist.to.TSS$dist.to.feature
gr_cpg$TSSname <- anno_result@dist.to.TSS$feature.name
mcols(gr_cpg) <- mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
dplyr::mutate(pos = min_rank(abs(dist2TSS))) %>% data.frame()
table(gr_cpg[gr_cpg$featureType != gr_cpg$region_type,]$region_type) ## all good
table(gr_cpg[gr_cpg$featureType != gr_cpg$preciseFeatureType,]$preciseFeatureType) ## all good
#########################################################################
## Find the first promoter and the first exon by absolute distance to TSS
gr_cpg$dist2TSS <- anno_result@dist.to.TSS$dist.to.feature
gr_cpg$TSSname <- anno_result@dist.to.TSS$feature.name
mcols(gr_cpg) <- mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(TSSname, featureType) %>%
dplyr::mutate(pos = min_rank(abs(dist2TSS))) %>% data.frame()
gr_cpg
mcols(gr_cpg)$featureType
mcols(gr_cpg)$featureType %in% "promoter"
ifelse(featureType %in% "exon" & pos %in% 1, "first exon", preciseFeatureType))
mcols(gr_cpg) %>%
mutate(preciseFeatureType =
ifelse(test = (featureType %in% "promoter" & pos %in% 1), yes = "first promoter",
no = ifelse(test = (featureType %in% "exon" & pos %in% 1), yes = "first exon",
no = preciseFeatureType)))
mcols(gr_cpg) %>%
mutate(
preciseFeatureType = case_when(
featureType == "promoter" & pos == 1 ~ "first promoter",
featureType == "exon" & pos == 1 ~ "first exon",
TRUE ~ as.character(preciseFeatureType)  # keep existing otherwise
)
)
mcols(gr_cpg) %>% as.data.frame() %>%
mutate(
preciseFeatureType = case_when(
featureType == "promoter" & pos == 1 ~ "first promoter",
featureType == "exon" & pos == 1 ~ "first exon",
TRUE ~ as.character(preciseFeatureType)  # keep existing otherwise
)
)
bed_features
# Import bed file
bed_features <- genomation::readTranscriptFeatures(
"~/Documents/Project_hvCpG/hg38_GENCODE_V47.bed")
mcols(gr_cpg) <- mcols(gr_cpg) %>% as.data.frame() %>%
mutate(
preciseFeatureType = case_when(
featureType == "promoter" & pos == 1 ~ "first promoter",
featureType == "exon" & pos == 1 ~ "first exon",
TRUE ~ as.character(preciseFeatureType)  # keep existing otherwise
)
)
ggplot(mcols(gr_cpg), aes(x = preciseFeatureType, y = alpha, fill = preciseFeatureType)) +
geom_violin()+
geom_boxplot(outlier.size = 0.5, alpha = 0.8, width = .3) +
theme_minimal(base_size = 14) +
labs(y = "p(hv)") +
scale_fill_brewer(palette = "Set2") +
theme(legend.position = "none", axis.title.x = element_blank())
## Kruskal–Wallis test: are the groups different in alpha values?
kruskal.test(alpha ~ preciseFeatureType, data = mcols(gr_cpg))
## Post-hoc pairwise comparison
pairwise_results <- pairwise.wilcox.test(
mcols(gr_cpg)$alpha,
mcols(gr_cpg)$preciseFeatureType,
p.adjust.method = "fdr"
)
pairwise_results
mcols(gr_cpg) %>% dplyr::group_by(preciseFeatureType) %>%
dplyr::summarise(meanAlpha = mean(alpha))
mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(preciseFeatureType) %>%
dplyr::summarise(meanAlpha = mean(alpha))
mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(preciseFeatureType) %>%
dplyr::summarise(meanAlpha = mean(alpha),
medianAlpha = median(alpha))
mcols(gr_cpg) %>% as.data.frame() %>%
dplyr::group_by(featureType) %>%
dplyr::summarise(meanAlpha = mean(alpha),
medianAlpha = median(alpha))
# visualize methylation levels by region
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 6, height = 4)
ggplot(mcols(gr_cpg), aes(x = preciseFeatureType, y = alpha, fill = preciseFeatureType)) +
geom_violin()+
geom_boxplot(outlier.size = 0.5, alpha = 0.8, width = .3) +
theme_minimal(base_size = 14) +
labs(y = "p(hv)") +
scale_fill_brewer(palette = "Set2") +
theme(legend.position = "none", axis.title.x = element_blank())
dev.off()
View(Atlas_dt)
