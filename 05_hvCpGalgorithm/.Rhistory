lower_ci <- NA
upper_ci <- NA
}
boot_res_list[[dataset_name]] <- data.frame(
dataset = dataset_name,
median_sd = median(sds, na.rm = TRUE),
lower = lower_ci,
upper = upper_ci
)
}
batchtimer <- batchtimer + 1
}
boot_df <- do.call(rbind, boot_res_list)
final_df <- merge(dfres, boot_df, by = "dataset", all = TRUE)
return(final_df)
}
df_hvstats_controls <- myrun_batch_boot(
batch_size = 10000,
cpg_ids = paste0(mQTLcontrols_GRanges_hg38@seqnames, "_", mQTLcontrols_GRanges_hg38@ranges),
B = 1000)
df_hvstats_hvCpGs <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = paste0(DerakhshanhvCpGs_GRanges_hg38@seqnames, "_", DerakhshanhvCpGs_GRanges_hg38@ranges),
B = 1000)
paste0(DerakhshanhvCpGs_GRanges_hg38@seqnames, "_", DerakhshanhvCpGs_GRanges_hg38@ranges)
paste0(DerakhshanhvCpGs_GRanges_hg38@seqnames, "_", DerakhshanhvCpGs_GRanges_hg38@ranges)
gr_cpg
dt_clean
dt_clean$alpha > 0.7
dt_clean$name
dt_clean$name[dt_clean$alpha > 0.7 & !is.na(dt_clean$alpha)]
dt_clean$alpha > 0.7
dev.off()
## Newly detected hvCpG as a comparison
df_hvstats_newhvCpGs <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = head(dt_clean$name[dt_clean$alpha > 0.9 & !is.na(dt_clean$alpha)], 100),
B = 1000)
## Newly detected hvCpG as a comparison
df_hvstats_newhvCpGs <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = head(dt_clean$name[dt_clean$alpha > 0.9 & !is.na(dt_clean$alpha)], 100),
B = 1000)
df <- rbind(df_hvstats_controls %>% mutate(type = "mQTLcontrol"),
df_hvstats_hvCpGs %>% mutate(type = "hvCpG"),
df_hvstats_newhvCpGs %>% mutate(type = "purCell hvCpG >0.9"))
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col= type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(pch = 21, size = 2) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
## Newly detected hvCpG as a comparison
df_hvstats_newhvCpGs09 <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = dt_clean$name[dt_clean$alpha > 0.9 & !is.na(dt_clean$alpha)],
B = 1000)
df_hvstats_controls
## Newly detected hvCpG as a comparison
df_hvstats_newhvCpGs09 <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = sample(dt_clean$name[dt_clean$alpha > 0.9 & !is.na(dt_clean$alpha)], 3000),
B = 1000)
df <- rbind(df_hvstats_controls %>% mutate(type = "mQTLcontrol"),
df_hvstats_hvCpGs %>% mutate(type = "hvCpG"),
df_hvstats_newhvCpGs09 %>% mutate(type = "3000 purCells-hvCpG proba 90%"),
df_hvstats_newhvCpGs07 %>% mutate(type = "3000 purCells-hvCpGs proba 70%+"))
df_hvstats_newhvCpGs07 <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = sample(dt_clean$name[dt_clean$alpha > 0.7 & !is.na(dt_clean$alpha)], 3000),
B = 1000)
df <- rbind(df_hvstats_controls %>% mutate(type = "mQTLcontrol"),
df_hvstats_hvCpGs %>% mutate(type = "hvCpG"),
df_hvstats_newhvCpGs09 %>% mutate(type = "3000 purCells-hvCpG proba 90%"),
df_hvstats_newhvCpGs07 %>% mutate(type = "3000 purCells-hvCpGs proba 70%+"))
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col= type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(pch = 21, size = 2) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
df_hvstats_newhvCpGs05 <- myrun_batch_boot(
batch_size = 1000,
cpg_ids = sample(dt_clean$name[dt_clean$alpha > 0.5 & !is.na(dt_clean$alpha)], 3000),
B = 1000)
paste0(DerakhshanhvCpGs_GRanges_hg38@seqnames, "_", DerakhshanhvCpGs_GRanges_hg38@ranges)
df <- rbind(df_hvstats_controls %>% mutate(type = "mQTLcontrol"),
df_hvstats_hvCpGs %>% mutate(type = "hvCpG (Derakhshan)"),
df_hvstats_newhvCpGs09 %>% mutate(type = "3000 purCells-hvCpG proba 90%+"),
df_hvstats_newhvCpGs07 %>% mutate(type = "3000 purCells-hvCpGs proba 70%+"),
df_hvstats_newhvCpGs05 %>% mutate(type = "3000 purCells-hvCpGs proba 50%+"))
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col= type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(pch = 21, size = 2) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
scale_color_viridis(discrete=TRUE) +
scale_fill_viridis(discrete=TRUE) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col= type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(pch = 21, size = 2) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
library(ggplot2)
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.5),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 0.5)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.5),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 0.5)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.5),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 0.6)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
df$type
as.factor(df$type)
factor(df$type)
levels(factor(df$type))
factor(df$type, levels =factor(df$type)[c(1,3,2,4,5)])
factor(df$type, levels =factor(df$type)[c(1,3,2,4,5)])
factor(df$type)
factor(df$type, levels = levels(factor(df$type))[c(1,3,2,4,5)])
df$type <- factor(df$type, levels = levels(factor(df$type))[c(1,3,2,4,5)])
levels(factor(df$type))
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.5),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 0.6)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.8),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 0.6)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.8),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 0.8)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.8),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 2)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 0.8),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0.8, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position.inside = c(0, 0.85),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") +
scale_y_log10()
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI") #+
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI")
ggplot(df, aes(x = dataset, y = median_sd, fill = type, col = type)) +
geom_pointrange(
aes(ymin = lower, ymax = upper),
position = position_dodge(width = 1),
shape = 21, size = 0.4, stroke = 0.5
) +
geom_point(
pch = 21, size = 2,
position = position_dodge(width = 1)
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.box = "horizontal",
legend.background = element_rect(fill = "white", color = "black", size = 0.4),
legend.key = element_rect(fill = "white", color = NA)
) +
guides(fill = guide_legend(title = NULL), colour = guide_legend(NULL)) +
xlab("") +
ylab("Median SD ± 95% CI")
