geom_text(aes(label = round(high_alpha_frac, 2)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
summary_dt
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = high_alpha_count), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha > 0.95]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha > 0.7]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
sum(Atlas_dt$alpha > 0.7)
sum(summary_dt$high_alpha_count)
source(here("05_hvCpGalgorithm/runAlgo_myDatasets/exploreResults/prepPreviousSIV.R"))
read.csv("../../dataPrev/MEs_not_publication_Noah_dont_select.txt")
read.csv(here("05_hvCpGalgorithm/dataPrev/MEs_not_publication_Noah_dont_select.txt"))
readxl::read_xls("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx))
vmeQTL <- readxl::read_xls("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx)
vmeQTL <- readxl::read_xls(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx))
vmeQTL <- readxl::read_xls(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL <- readxl::read_xls(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL <- readxl::read_xls("../../../05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx")
vmeQTL <- readxl::read_xlsx("../../../05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx")
vmeQTL <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
View(vmeQTL)
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
dico
dico$CpG
match(vmeQTL_hg19probes$vCpG, dico$CpG)
dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]
vmeQTL_hg19probes$chrpos_hg38 <- dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]
vmeQTL_hg19probes
###########################################
## Kessler2018_687SIVregions_2WGBS hg19! ##
KesslerSIV_GRanges_hg38
length(KesslerSIV_hg38) # 819
length(KesslerSIV_GRanges_hg38) # 819
## Add previous MEs including Maria's results
source(here("05_hvCpGalgorithm/runAlgo_myDatasets/exploreResults/prepPreviousSIV.R"))
# a vector of 1773 SIV from Harris 2012 (HarrisSIV_hg38)
HarrisSIV_hg38
# one of 1579 ESS from Van Baak 2018 (VanBaakESS_hg38)
VanBaakESS_hg38
# a GRange object for Kessler 2018 676 SIV regions (KesslerSIV_GRanges_hg38)
KesslerSIV_GRanges_hg38
# a GRange object for Gunasekara 2019 9926 corSIV regions (corSIV_GRanges_hg38)
corSIV_GRanges_hg38
# a vector of 3644 hvCpG from Derakhshan 2022 (DerakhshanhvCpGs_hg38)
DerakhshanhvCpGs_hg38
# a vector for matching mQTL controls (mQTLcontrols_hg38)
mQTLcontrols_hg38
head(Atlas_dt)
# a GRange object for Kessler 2018 676 SIV regions (KesslerSIV_GRanges_hg38)
KesslerSIV_GRanges_hg38
# Parse with regex
parsed <- str_match(Atlas_dt$name, "(chr[0-9XYM]+)_(\\d+)-(\\d+)")
# Parse with regex
parsed <- str_match(Atlas_dt$name, "(chr[0-9XYM]+)_(\\d+)")
## Calculate high alpha
Atlas_dt[, high_alpha := alpha > 0.95]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha > 0.5]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha > 0.1]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha < 0.1]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha < 0.05]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha < 0.05]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
## Calculate high alpha
Atlas_dt[, high_alpha := alpha < 0.05]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
# X-squared = 23940, df = 3, p-value < 2.2e-16
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
## Calculate high alpha
Atlas_dt[, high_alpha := alpha >0.7]
summary_dt <- Atlas_dt[, .(
total = .N,
high_alpha_count = sum(high_alpha)
), by = region_type]
summary_dt[, high_alpha_frac := high_alpha_count / total]
summary_dt
# Contingency table: rows=category, columns=high vs not high
tab <- Atlas_dt[, .N, by = .(region_type, high_alpha)]
cont_tab <- xtabs(N ~ region_type + high_alpha, data = tab)
chisq.test(cont_tab)
pdf(here("05_hvCpGalgorithm/figures/barplotFeaturesbyAlpha.pdf"), width = 5, height = 4)
ggplot(summary_dt, aes(x = region_type, y = high_alpha_frac, fill = region_type)) +
geom_col() +
geom_text(aes(label = paste0("N=", high_alpha_count)), vjust = -0.1) +
labs(y = "Fraction high alpha (>70%)", x = "Category") +
theme_minimal(base_size = 14) +
theme(legend.position = "none") +
scale_fill_viridis_d()
dev.off()
sum(Atlas_dt$alpha > 0.7) # 700603
sum(summary_dt$high_alpha_count)
###########################################
## meQTL (vmeQTL) identified in MZ twins by Jordana Bell
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL_hg19probes$chrpos_hg38 <- dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]
# a vector of 1773 SIV from Harris 2012 (HarrisSIV_hg38)
HarrisSIV_hg38
# one of 1579 ESS from Van Baak 2018 (VanBaakESS_hg38)
VanBaakESS_hg38
# a GRange object for Kessler 2018 676 SIV regions (KesslerSIV_GRanges_hg38)
KesslerSIV_GRanges_hg38
head(parsed)
# Build GRanges
allcpg_GR <- GRanges(
seqnames = parsed[,2],
ranges   = IRanges(start = as.numeric(parsed[,3]),
end   = as.numeric(parsed[,3]))
)
# Build GRanges
allcpg_GR <- GRanges(
seqnames = parsed[,2],
ranges   = IRanges(start = as.numeric(parsed[,3]),
end   = as.numeric(parsed[,3]))
); rm(parsed)
###########################################
## meQTL (vmeQTL) identified in MZ twins by Jordana Bell
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL_hg19probes$chrpos_hg38 <- dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]
# a vector of 1773 SIV from Harris 2012 (HarrisSIV_hg38)
HarrisSIV_hg38
vmeQTL_hg19probes
###########################################
## meQTL (vmeQTL) identified in MZ twins by Jordana Bell
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL_hg38 <- dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]
vmeQTL_hg38
###########################################
## meQTL (vmeQTL) identified in MZ twins by Jordana Bell
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL_hg38 <- na.omit(dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)])
###########################################
## meQTL (vmeQTL) identified in MZ twins by Jordana Bell
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL_hg38 <- na.omit(dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]) ; rm(vmeQTL_hg19probes)
# a vector of 1773 SIV from Harris 2012 (HarrisSIV_hg38)
HarrisSIV_hg38
# one of 1579 ESS from Van Baak 2018 (VanBaakESS_hg38)
VanBaakESS_hg38
# a GRange object for Kessler 2018 676 SIV regions (KesslerSIV_GRanges_hg38)
KesslerSIV_GRanges_hg38
# a GRange object for Kessler 2018 676 SIV regions (KesslerSIV_GRanges_hg38)
KesslerSIV_hg38 <- findOverlaps(query = KesslerSIV_GRanges_hg38, subject = allcpg_GR)
KesslerSIV_hg38
# a GRange object for Kessler 2018 676 SIV regions (KesslerSIV_GRanges_hg38)
overlaps <- findOverlaps(query = KesslerSIV_GRanges_hg38, subject = allcpg_GR)
# Extract the overlapping ranges
CpG_overlapping     <- cpg_46_GR[subjectHits(overlaps)]
KesslerSIV_hg38 <- paste0(CpG_overlapping@seqnames, "_", CpG_overlapping@ranges)
# Extract the overlapping ranges
CpG_overlapping     <- allcpg_GR[subjectHits(overlaps)]
KesslerSIV_hg38 <- paste0(CpG_overlapping@seqnames, "_", CpG_overlapping@ranges)
KesslerSIV_hg38 <- na.omit(KesslerSIV_hg38)
length(KesslerSIV_hg38) # 819
KesslerSIV_hg38
# a GRange object for Gunasekara 2019 9926 corSIV regions (corSIV_GRanges_hg38)
corSIV_GRanges_hg38
# a GRange object for Gunasekara 2019 9926 corSIV regions (corSIV_GRanges_hg38)
overlaps <- findOverlaps(query = corSIV_GRanges_hg38, subject = allcpg_GR)
# Extract the overlapping ranges
CpG_overlapping     <- allcpg_GR[subjectHits(overlaps)]
corSIV_hg38 <- paste0(CpG_overlapping@seqnames, "_", CpG_overlapping@ranges)
corSIV_hg38 <- na.omit(paste0(CpG_overlapping@seqnames, "_", CpG_overlapping@ranges))
length(corSIV_hg38) # 2700
# a vector of 3644 hvCpG from Derakhshan 2022 (DerakhshanhvCpGs_hg38)
DerakhshanhvCpGs_hg38
# a vector for matching mQTL controls (mQTLcontrols_hg38)
mQTLcontrols_hg38
###############################
## Silver2022_SoCCpGs_10WGBS ##
arrayRef <- readxl::read_excel(here("05_hvCpGalgorithm/dataPrev/Silver2022_259SoC_hg19.xlsx"), sheet = 3, skip = 2)
SoCCpGs <- readxl::read_excel(here("05_hvCpGalgorithm/dataPrev/Silver2022_259SoC_hg19.xlsx"), sheet = 6, skip = 2)
SoCCpGs_GRanges <- GRanges(
seqnames = paste0("chr", arrayRef$chr[match(SoCCpGs$cpg, arrayRef$cpg)]),
ranges = IRanges(start = arrayRef$loc[match(SoCCpGs$cpg, arrayRef$cpg)],
end = arrayRef$loc[match(SoCCpGs$cpg, arrayRef$cpg)] + 1),
strand = "*")
SoCCpGs_GRanges
SoCCpGs_GRanges <- GRanges(
seqnames = paste0("chr", arrayRef$chr[match(SoCCpGs$cpg, arrayRef$cpg)]),
ranges = IRanges(start = arrayRef$loc[match(SoCCpGs$cpg, arrayRef$cpg)],
end = arrayRef$loc[match(SoCCpGs$cpg, arrayRef$cpg)]),
strand = "*")
SoCCpGs_GRanges
SoCCpGs
###############################
## Silver2022_SoCCpGs_10WGBS ##
arrayRef <- readxl::read_excel(here("05_hvCpGalgorithm/dataPrev/Silver2022_259SoC_hg19.xlsx"), sheet = 3, skip = 2)
SoCCpGs <- readxl::read_excel(here("05_hvCpGalgorithm/dataPrev/Silver2022_259SoC_hg19.xlsx"), sheet = 6, skip = 2)
SoCCpGs
length(SoCCpGs$cpg)
SoCCpGs$cpg
dico[match(SoCCpGs$cpg, dico$CpG), "chrpos_hg38"]
SoCCpGs_hg38 <- dico[match(SoCCpGs$cpg, dico$CpG), "chrpos_hg38"]
length(SoCCpGs_hg38) #177
SoCCpGs_hg38 <- na.omit(dico[match(SoCCpGs$cpg, dico$CpG), "chrpos_hg38"])
###############################
## Silver2022_SoCCpGs_10WGBS ##
arrayRef <- readxl::read_excel(here("05_hvCpGalgorithm/dataPrev/Silver2022_259SoC_hg19.xlsx"), sheet = 3, skip = 2)
###############################
## Silver2022_SoCCpGs_10WGBS ##
SoCCpGs <- readxl::read_excel(here("05_hvCpGalgorithm/dataPrev/Silver2022_259SoC_hg19.xlsx"), sheet = 6, skip = 2)
SoCCpGs_hg38 <- na.omit(dico[match(SoCCpGs$cpg, dico$CpG), "chrpos_hg38"])
length(SoCCpGs_hg38) #177
# ## Silver2022_SoCCpGs_10WGBS ##
SoCCpGs_hg38
#################################
## Check overlaps with upset plot
sets <- list(
HarrisSIV = HarrisSIV_hg38,
VanBaakESS = VanBaakESS_hg38,
KesslerSIV = KesslerSIV_hg38,
CoRSIV = corSIV_hg38,
SoCCpGs = SoCCpGs_hg38,
hvCpG = hvCpGandControls$DerakhshanhvCpGs_names,
mQTLcontrols = hvCpGandControls$mQTLcontrols_names
)
#################################
## Check overlaps with upset plot
sets <- list(
HarrisSIV = HarrisSIV_hg38,
VanBaakESS = VanBaakESS_hg38,
KesslerSIV = KesslerSIV_hg38,
CoRSIV = corSIV_hg38,
SoCCpGs = SoCCpGs_hg38,
hvCpG = DerakhshanhvCpGs_hg38,
mQTLcontrols = mQTLcontrols_hg38
)
# Create the plot in a base graphics device
pdf(NULL)  # draw to null device to avoid displaying
upset(fromList(sets), nsets = 7, order.by = "freq")
grid_plot <- grid.grab()  # Capture as a grid object
dev.off()
MEsetdt <- rbindlist(lapply(names(sets), function(nm) {
Atlas_dt[.(sets[[nm]]), on = .(name), .(name, alpha)][, ME := nm]
}))
#################################
## Check overlaps with upset plot
sets <- list(
vmeQTL = vmeQTL_hg38
HarrisSIV = HarrisSIV_hg38,
upset(fromList(sets), nsets = 7, order.by = "freq")
grid_plot <- grid.grab()  # Capture as a grid object
dev.off()
# Now save the captured grid object to a real PDF
pdf(here("05_hvCpGalgorithm/figures/upsetPreviousME.pdf"), width = 12, height = 5)
grid.draw(grid_plot)
dev.off()
MEsetdt <- rbindlist(lapply(names(sets), function(nm) {
Atlas_dt[.(sets[[nm]]), on = .(name), .(name, alpha)][, ME := nm]
}))
pdf(here("05_hvCpGalgorithm/figures/alphaComparisonBetweenMEtypes.pdf"), width = 13, height = 4)
cowplot::plot_grid(p1,p2, rel_widths = c(1, .8))
dev.off()
#################################
## Check overlaps with upset plot
sets <- list(
vmeQTL = vmeQTL_hg38,
HarrisSIV = HarrisSIV_hg38,
VanBaakESS = VanBaakESS_hg38,
KesslerSIV = KesslerSIV_hg38,
CoRSIV = corSIV_hg38,
SoCCpGs = SoCCpGs_hg38,
hvCpG = DerakhshanhvCpGs_hg38,
mQTLcontrols = mQTLcontrols_hg38
)
# Create the plot in a base graphics device
pdf(NULL)  # draw to null device to avoid displaying
upset(fromList(sets), nsets = 7, order.by = "freq")
grid_plot <- grid.grab()  # Capture as a grid object
dev.off()
# Now save the captured grid object to a real PDF
pdf(here("05_hvCpGalgorithm/figures/upsetPreviousME.pdf"), width = 12, height = 5)
grid.draw(grid_plot)
dev.off()
#######################################################
## Check alpha for the different MEs: are they high? ##
MEsetdt <- rbindlist(lapply(names(sets), function(nm) {
Atlas_dt[.(sets[[nm]]), on = .(name), .(name, alpha)][, ME := nm]
}))
MEsetdt <- na.omit(MEsetdt) ## 33478 so far (2 sept)
## Control as baseline
MEsetdt[, ME := relevel(factor(ME), ref = "mQTLcontrols")]
p1 <- ggplot(MEsetdt, aes(x = ME, y = alpha)) +
geom_jitter(data = MEsetdt,
aes(fill=ME), pch=21, size = 3, alpha = .1)+
geom_violin(aes(col=ME))+
geom_boxplot(aes(col=ME), width = .1) +
theme_minimal(base_size = 14) +
theme(legend.position = "none", axis.title.x = element_blank()) +
ylab("Probability of being a hvCpG")
p1
## Statistical comparisons of alpha between MEs
# 1️⃣ Fit the model with mQTLcontrols as baseline
fit <- lm(alpha ~ ME, data = MEsetdt)
# 2️⃣ Get estimated marginal means and contrasts vs baseline
emm <- emmeans(fit, ~ ME)
contrasts <- contrast(emm, method = "trt.vs.ctrl", ref = "mQTLcontrols", adjust = "sidak") %>%
as.data.frame()
# 3️⃣ Prepare for plotting
contrasts <- contrasts %>%
mutate(ME = contrast,  # rename for clarity
lower = estimate - 1.96*SE,
upper = estimate + 1.96*SE)
# 4️⃣ Plot
p2 <- ggplot(contrasts, aes(x = ME, y = estimate)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
coord_flip() +
labs(
y = "Difference in alpha vs mQTLcontrols",
x = "ME group",
title = "Comparison of ME groups to mQTLcontrols",
subtitle = "lm with multiple comparison correction (Sidak)"
) +
theme_minimal()
pdf(here("05_hvCpGalgorithm/figures/alphaComparisonBetweenMEtypes.pdf"), width = 13, height = 4)
cowplot::plot_grid(p1,p2, rel_widths = c(1, .8))
dev.off()
## TBC
pdf(here("05_hvCpGalgorithm/figures/alphaComparisonBetweenMEtypes.pdf"), width = 14, height = 4)
cowplot::plot_grid(p1,p2, rel_widths = c(1, .8))
dev.off()
###########################################
## meQTL (vmeQTL) identified in MZ twins by Jordana Bell
vmeQTL_hg19probes <- readxl::read_xlsx(here("05_hvCpGalgorithm/dataPrev/vmeQTL_vCpG_359pair_sig_Zhang2025.xlsx"))
vmeQTL_hg38 <- na.omit(dico$chrpos_hg38[match(vmeQTL_hg19probes$vCpG, dico$CpG)]) ; rm(vmeQTL_hg19probes)
vmeQTL_hg38
